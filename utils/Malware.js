import axios from 'axios'

export const GoogleMalwareDetector = async (targetUrl) => {
    if (!process.env.GOOGLE_SAFEBROWSING_API_KEY) return

    const isMalware = await axios.post(
        `https://safebrowsing.googleapis.com/v4/threatMatches:find?key=${process.env.GOOGLE_SAFEBROWSING_API_KEY}`,
        {
            client: {
                clientId: 'shortendomains',
                clientVersion: '1.0.0',
            },
            threatInfo: {
                threatTypes: [
                    'THREAT_TYPE_UNSPECIFIED',
                    'MALWARE',
                    'SOCIAL_ENGINEERING',
                    'UNWANTED_SOFTWARE',
                    'POTENTIALLY_HARMFUL_APPLICATION',
                ],
                platformTypes: ['ANY_PLATFORM', 'PLATFORM_TYPE_UNSPECIFIED'],
                threatEntryTypes: [
                    'EXECUTABLE',
                    'URL',
                    'THREAT_ENTRY_TYPE_UNSPECIFIED',
                ],
                threatEntries: [{ url: targetUrl }],
            },
        }
    )

    if (!isMalware.data || !isMalware.data.matches) return false

    return true
}
